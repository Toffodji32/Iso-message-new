<?php

namespace App\Controller;

use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use App\Repository\ContactRepository;
use App\Repository\ContactGroupRepository;

class DashboardController extends AbstractController
{
    /**
     * @Route("/dashboard", name="app_dashboard")
     */
    public function index(
        ContactRepository $contactRepository,
        ContactGroupRepository $contactGroupRepository,
    ): Response {

        $totalContacts = $contactRepository->count([]);
        $totalGroups = $contactGroupRepository->count([]);

        $stats = [
            'total_contacts' => $totalContacts,
            'total_groups' => $totalGroups,
        ];




        $recentContacts = $contactRepository->findBy(
            [],
            ['createdAt' => 'DESC'],
            5             
        );

        // Si 'createdAt' n'existe pas, vous pouvez utiliser 'id'
        // $recentContacts = $contactRepository->findBy(
        //     [],
        //     ['id' => 'DESC'],
        //     5
        // );


        return $this->render('dashboard/index.html.twig', [
            'sms_balance' => 1000, // Remplacez par la logique réelle de solde SMS
            'stats' => $stats,
            'recent_contacts' => $recentContacts, // Passez les contacts récents à la vue
        ]);
    }
}
